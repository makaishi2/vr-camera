<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>Watson VRサンプルアプリ</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script>
$(document).ready(function () {
    $("#send").click(function (event) {
        var elem =  document.getElementById("result");
        elem.innerHTML = '';
        var form = $('#fileUploadForm')[0];
        var data = new FormData(form);
        $("#send").prop("disabled", true);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "/send",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 600000,
            success: function (data) {
                var elem =  document.getElementById("result");
                elem.style.fontSize = '70%';
                elem.innerHTML = data;
                console.log("SUCCESS : ", data);
                $("#send").prop("disabled", false);
            },
            error: function (e) {
                $("#result").text(e.responseText);
                console.log("ERROR : ", e);
                $("#send").prop("disabled", false);
            }
        });
    });
});

$(function(){
    $('#fileUploadForm').on('change', 'input[type="file"]', function(e) {
        var file = e.target.files[0];
        var reader = new FileReader();
        var $preview = $(".preview");
        var t = this;
        if(file.type.indexOf("image") < 0){
            return false;
        }
        reader.onload = (function(file) {
            return function(e) {
                $preview.empty();
                $preview.append($('<img>').attr({
                    src: e.target.result,
                    height: "200px",
                    class: "preview",
                    title: file.name
                }));
            };
        })(file);
        reader.readAsDataURL(file);
    });
})

</script>
</head>
<body>
<h3>Watson VR サンプルアプリ</h3>
<div style="height:200px" class="preview"> </div>
<form action="/send" method="post" enctype="multipart/form-data" id="fileUploadForm">
<br>
<input type="file" name="image" accept="image/*">
<br>
<br>
<input type="checkbox" id="vr_type" name="vr_type" value="1" checked="checked">一般種別
<input type="checkbox" id="vr_type" name="vr_type" value="2">一般種別(食品)
<input type="checkbox" id="vr_type" name="vr_type" value="3">カスタム
<input type="checkbox" id="vr_type" name="vr_type" value="4">顔認識
<input type="checkbox" id="vr_type" name="vr_type" value="5">文字認識
<br>
<br>
<input type="button" name="button" value="VR分析開始" id="send"/>
</form>
<hr>
<div id="result"></div>
</body>
</html>
